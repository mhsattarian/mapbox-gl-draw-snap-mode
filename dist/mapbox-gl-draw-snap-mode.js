!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.mapboxGlDrawSnapMode=e():t.mapboxGlDrawSnapMode=e()}(this,(function(){return(()=>{"use strict";var t={491:(t,e,r)=>{r.r(e),r.d(e,{SnapLineMode:()=>oe,SnapModeDrawStyles:()=>we,SnapPointMode:()=>Zt,SnapPolygonMode:()=>de});const n="add",i="move",o="pointer",a="none",s="polygon",l="line_string",c="point",u="Feature",p="Polygon",f="LineString",d="Point",h="simple_select",g="draw.create",y="feature",m="vertex",v="true",b="false",w={enable(t){setTimeout((()=>{t.map&&t.map.doubleClickZoom&&t._ctx&&t._ctx.store&&t._ctx.store.getInitialConfigValue&&t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()}),0)},disable(t){setTimeout((()=>{t.map&&t.map.doubleClickZoom&&t.map.doubleClickZoom.disable()}),0)}};function x(t){const e=t.featureTarget;return!!e&&(!!e.properties&&e.properties.meta===m)}function M(t){return 27===t.keyCode}function P(t){return 13===t.keyCode}const S={onSetup:function(){const t=this.newFeature({type:u,properties:{},geometry:{type:d,coordinates:[]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:n}),this.activateUIButton(c),this.setActionableState({trash:!0}),{point:t}},stopDrawingAndRemove:function(t){this.deleteFeature([t.point.id],{silent:!0}),this.changeMode(h)}};S.onTap=S.onClick=function(t,e){this.updateUIClasses({mouse:i}),t.point.updateCoordinate("",e.lngLat.lng,e.lngLat.lat),this.map.fire(g,{features:[t.point.toGeoJSON()]}),this.changeMode(h,{featureIds:[t.point.id]})},S.onStop=function(t){this.activateUIButton(),t.point.getCoordinate().length||this.deleteFeature([t.point.id],{silent:!0})},S.toDisplayFeatures=function(t,e,r){const n=e.properties.id===t.point.id;if(e.properties.active=n?v:b,!n)return r(e)},S.onTrash=S.stopDrawingAndRemove,S.onKeyUp=function(t,e){if(M(e)||P(e))return this.stopDrawingAndRemove(t,e)};const O=S;var j=6371008.8,E={meters:j,metres:j,millimeters:6371008800,millimetres:6371008800,centimeters:637100880,centimetres:637100880,kilometers:6371.0088,kilometres:6371.0088,miles:3958.761333810546,nauticalmiles:j/1852,inches:39.37*j,yards:5825721.287490856,feet:20902260.511392,radians:1,degrees:57.22891354143274};function C(t,e,r){if(!D(r=r||{}))throw new Error("options is invalid");var n=r.bbox,i=r.id;if(void 0===t)throw new Error("geometry is required");if(e&&e.constructor!==Object)throw new Error("properties must be an Object");n&&U(n),i&&$(i);var o={type:"Feature"};return i&&(o.id=i),n&&(o.bbox=n),o.properties=e||{},o.geometry=t,o}function L(t,e,r){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!X(t[0])||!X(t[1]))throw new Error("coordinates must contain numbers");return C({type:"Point",coordinates:t},e,r)}function A(t,e,r){if(!t)throw new Error("coordinates is required");for(var n=0;n<t.length;n++){var i=t[n];if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var o=0;o<i[i.length-1].length;o++){if(0===n&&0===o&&!X(i[0][0])||!X(i[0][1]))throw new Error("coordinates must contain numbers");if(i[i.length-1][o]!==i[0][o])throw new Error("First and last Position are not equivalent.")}}return C({type:"Polygon",coordinates:t},e,r)}function F(t,e,r){if(!t)throw new Error("coordinates is required");if(t.length<2)throw new Error("coordinates must be an array of two or more positions");if(!X(t[0][1])||!X(t[0][1]))throw new Error("coordinates must contain numbers");return C({type:"LineString",coordinates:t},e,r)}function k(t,e){if(!D(e=e||{}))throw new Error("options is invalid");var r=e.bbox,n=e.id;if(!t)throw new Error("No features passed");if(!Array.isArray(t))throw new Error("features must be an Array");r&&U(r),n&&$(n);var i={type:"FeatureCollection"};return n&&(i.id=n),r&&(i.bbox=r),i.features=t,i}function _(t,e,r){if(!t)throw new Error("coordinates is required");return C({type:"MultiLineString",coordinates:t},e,r)}function I(t,e){if(null==t)throw new Error("radians is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var r=E[e||"kilometers"];if(!r)throw new Error(e+" units is invalid");return t*r}function V(t,e){if(null==t)throw new Error("distance is required");if(e&&"string"!=typeof e)throw new Error("units must be a string");var r=E[e||"kilometers"];if(!r)throw new Error(e+" units is invalid");return t/r}function B(t){if(null==t)throw new Error("radians is required");return 180*(t%(2*Math.PI))/Math.PI}function Y(t){if(null==t)throw new Error("degrees is required");return t%360*Math.PI/180}function X(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function D(t){return!!t&&t.constructor===Object}function U(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!X(t))throw new Error("bbox must only contain numbers")}))}function $(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}const G=function(t){U(t);var e=Number(t[0]),r=Number(t[1]),n=Number(t[2]),i=Number(t[3]);if(6===t.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var o=[e,r];return A([[o,[n,r],[n,i],[e,i],o]])};function q(t){if(!t)throw new Error("obj is required");var e=T(t);if(e.length>1&&X(e[0])&&X(e[1]))return e;throw new Error("Coordinate is not a valid Point")}function T(t){if(!t)throw new Error("obj is required");var e;if(t.length?e=t:t.coordinates?e=t.coordinates:t.geometry&&t.geometry.coordinates&&(e=t.geometry.coordinates),e)return N(e),e;throw new Error("No valid coordinates")}function N(t){if(t.length>1&&X(t[0])&&X(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return N(t[0]);throw new Error("coordinates must only contain numbers")}function z(t,e,r){var n=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var i=0,o=e.length-1;i<e.length;o=i++){var a=e[i][0],s=e[i][1],l=e[o][0],c=e[o][1];if(t[1]*(a-l)+s*(l-t[0])+c*(t[0]-a)==0&&(a-t[0])*(l-t[0])<=0&&(s-t[1])*(c-t[1])<=0)return!r;s>t[1]!=c>t[1]&&t[0]<(l-a)*(t[1]-s)/(c-s)+a&&(n=!n)}return n}const J=function(t,e,r){if("object"!=typeof(r=r||{}))throw new Error("options is invalid");var n=r.ignoreBoundary;if(!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var i=q(t),o=T(e),a=e.geometry?e.geometry.type:e.type,s=e.bbox;if(s&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(i,s))return!1;"Polygon"===a&&(o=[o]);for(var l=0,c=!1;l<o.length&&!c;l++)if(z(i,o[l][0],n)){for(var u=!1,p=1;p<o[l].length&&!u;)z(i,o[l][p],!n)&&(u=!0),p++;u||(c=!0)}return c};function R(t,e,r){if(null!==t)for(var n,i,o,a,s,l,c,u,p=0,f=0,d=t.type,h="FeatureCollection"===d,g="Feature"===d,y=h?t.features.length:1,m=0;m<y;m++){s=(u=!!(c=h?t.features[m].geometry:g?t.geometry:t)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var v=0;v<s;v++){var b=0,w=0;if(null!==(a=u?c.geometries[v]:c)){l=a.coordinates;var x=a.type;switch(p=!r||"Polygon"!==x&&"MultiPolygon"!==x?0:1,x){case null:break;case"Point":e(l,f,m,b,w),f++,b++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++)e(l[n],f,m,b,w),f++,"MultiPoint"===x&&b++;"LineString"===x&&b++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(i=0;i<l[n].length-p;i++)e(l[n][i],f,m,b,w),f++;"MultiLineString"===x&&b++,"Polygon"===x&&w++}"Polygon"===x&&b++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for("MultiPolygon"===x&&(w=0),i=0;i<l[n].length;i++){for(o=0;o<l[n][i].length-p;o++)e(l[n][i][o],f,m,b,w),f++;w++}b++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)R(a.geometries[n],e,r);break;default:throw new Error("Unknown Geometry Type")}}}}}function Z(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)e(t.features[r],r)}function H(t,e){var r,n,i,o,a,s,l,c,u,p,f=0,d="FeatureCollection"===t.type,h="Feature"===t.type,g=d?t.features.length:1;for(r=0;r<g;r++){for(s=d?t.features[r].geometry:h?t.geometry:t,c=d?t.features[r].properties:h?t.properties:{},u=d?t.features[r].bbox:h?t.bbox:void 0,p=d?t.features[r].id:h?t.id:void 0,a=(l=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=l?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":e(o,f,c,u,p);break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)e(o.geometries[n],f,c,u,p);break;default:throw new Error("Unknown Geometry Type")}else e(null,f,c,u,p);f++}}function K(t,e){H(t,(function(t,r,n,i,o){var a,s=null===t?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return void e(C(t,n,{bbox:i,id:o}),r,0)}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}t.coordinates.forEach((function(t,i){e(C({type:a,coordinates:t},n),r,i)}))}))}function Q(t,e,r,n,i){for(;n>r;){if(n-r>600){var o=n-r+1,a=e-r+1,s=Math.log(o),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(o-l)/o)*(a-o/2<0?-1:1);Q(t,e,Math.max(r,Math.floor(e-a*l/o+c)),Math.min(n,Math.floor(e+(o-a)*l/o+c)),i)}var u=t[e],p=r,f=n;for(W(t,r,e),i(t[n],u)>0&&W(t,r,n);p<f;){for(W(t,p,f),p++,f--;i(t[p],u)<0;)p++;for(;i(t[f],u)>0;)f--}0===i(t[r],u)?W(t,r,f):W(t,++f,n),f<=e&&(r=f+1),e<=f&&(n=f-1)}}function W(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function tt(t,e){return t<e?-1:t>e?1:0}const et=function(t,e,r,n,i){Q(t,e,r||0,n||t.length-1,i||tt)};function rt(t,e){if(!(this instanceof rt))return new rt(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function nt(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}function it(t,e){ot(t,0,t.children.length,e,t)}function ot(t,e,r,n,i){i||(i=dt(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,a=e;a<r;a++)o=t.children[a],at(i,t.leaf?n(o):o);return i}function at(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function st(t,e){return t.minX-e.minX}function lt(t,e){return t.minY-e.minY}function ct(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function ut(t){return t.maxX-t.minX+(t.maxY-t.minY)}function pt(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function ft(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function dt(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ht(t,e,r,n,i){for(var o,a=[e,r];a.length;)(r=a.pop())-(e=a.pop())<=n||(o=e+Math.ceil((r-e)/n/2)*n,et(t,o,e,r,i),a.push(e,o,o,r))}rt.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,r=[],n=this.toBBox;if(!ft(t,e))return r;for(var i,o,a,s,l=[];e;){for(i=0,o=e.children.length;i<o;i++)a=e.children[i],ft(t,s=e.leaf?n(a):a)&&(e.leaf?r.push(a):pt(t,s)?this._all(a,r):l.push(a));e=l.pop()}return r},collides:function(t){var e=this.data,r=this.toBBox;if(!ft(t,e))return!1;for(var n,i,o,a,s=[];e;){for(n=0,i=e.children.length;n<i;n++)if(o=e.children[n],ft(t,a=e.leaf?r(o):o)){if(e.leaf||pt(t,a))return!0;s.push(o)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,r=t.length;e<r;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=dt([]),this},remove:function(t,e){if(!t)return this;for(var r,n,i,o,a=this.data,s=this.toBBox(t),l=[],c=[];a||l.length;){if(a||(a=l.pop(),n=l[l.length-1],r=c.pop(),o=!0),a.leaf&&-1!==(i=nt(t,a.children,e)))return a.children.splice(i,1),l.push(a),this._condense(l),this;o||a.leaf||!pt(a,s)?n?(r++,a=n.children[r],o=!1):a=null:(l.push(a),c.push(r),r=0,n=a,a=a.children[0])}return this},toBBox:function(t){return t},compareMinX:st,compareMinY:lt,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},_build:function(t,e,r,n){var i,o=r-e+1,a=this._maxEntries;if(o<=a)return it(i=dt(t.slice(e,r+1)),this.toBBox),i;n||(n=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,n-1))),(i=dt([])).leaf=!1,i.height=n;var s,l,c,u,p=Math.ceil(o/a),f=p*Math.ceil(Math.sqrt(a));for(ht(t,e,r,f,this.compareMinX),s=e;s<=r;s+=f)for(ht(t,s,c=Math.min(s+f-1,r),p,this.compareMinY),l=s;l<=c;l+=p)u=Math.min(l+p-1,c),i.children.push(this._build(t,l,u,n-1));return it(i,this.toBBox),i},_chooseSubtree:function(t,e,r,n){for(var i,o,a,s,l,c,u,p,f,d;n.push(e),!e.leaf&&n.length-1!==r;){for(u=p=1/0,i=0,o=e.children.length;i<o;i++)l=ct(a=e.children[i]),f=t,d=a,(c=(Math.max(d.maxX,f.maxX)-Math.min(d.minX,f.minX))*(Math.max(d.maxY,f.maxY)-Math.min(d.minY,f.minY))-l)<p?(p=c,u=l<u?l:u,s=a):c===p&&l<u&&(u=l,s=a);e=s||e.children[0]}return e},_insert:function(t,e,r){var n=this.toBBox,i=r?t:n(t),o=[],a=this._chooseSubtree(i,this.data,e,o);for(a.children.push(t),at(a,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var r=t[e],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var o=this._chooseSplitIndex(r,i,n),a=dt(r.children.splice(o,r.children.length-o));a.height=r.height,a.leaf=r.leaf,it(r,this.toBBox),it(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(r,a)},_splitRoot:function(t,e){this.data=dt([t,e]),this.data.height=t.height+1,this.data.leaf=!1,it(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,r){var n,i,o,a,s,l,c,u,p,f,d,h,g,y;for(l=c=1/0,n=e;n<=r-e;n++)i=ot(t,0,n,this.toBBox),o=ot(t,n,r,this.toBBox),p=i,f=o,d=void 0,h=void 0,g=void 0,y=void 0,d=Math.max(p.minX,f.minX),h=Math.max(p.minY,f.minY),g=Math.min(p.maxX,f.maxX),y=Math.min(p.maxY,f.maxY),a=Math.max(0,g-d)*Math.max(0,y-h),s=ct(i)+ct(o),a<l?(l=a,u=n,c=s<c?s:c):a===l&&s<c&&(c=s,u=n);return u},_chooseSplitAxis:function(t,e,r){var n=t.leaf?this.compareMinX:st,i=t.leaf?this.compareMinY:lt;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,i)&&t.children.sort(n)},_allDistMargin:function(t,e,r,n){t.children.sort(n);var i,o,a=this.toBBox,s=ot(t,0,e,a),l=ot(t,r-e,r,a),c=ut(s)+ut(l);for(i=e;i<r-e;i++)o=t.children[i],at(s,t.leaf?a(o):o),c+=ut(s);for(i=r-e-1;i>=e;i--)o=t.children[i],at(l,t.leaf?a(o):o),c+=ut(l);return c},_adjustParentBBoxes:function(t,e,r){for(var n=r;n>=0;n--)at(e[n],t)},_condense:function(t){for(var e,r=t.length-1;r>=0;r--)0===t[r].children.length?r>0?(e=t[r-1].children).splice(e.indexOf(t[r]),1):this.clear():it(t[r],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};const gt=rt;function yt(t){var e=[t[0],t[1]],r=[t[0],t[3]],n=[t[2],t[3]];return{type:"Feature",bbox:t,properties:{},geometry:{type:"Polygon",coordinates:[[e,[t[2],t[1]],n,r,e]]}}}function mt(t){var e=[1/0,1/0,-1/0,-1/0];return R(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}const vt=function(t){var e=gt(t);return e.insert=function(t){if(Array.isArray(t)){var e=t;(t=yt(e)).bbox=e}else t.bbox=t.bbox?t.bbox:mt(t);return gt.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach((function(t){var r=yt(t);r.bbox=t,e.push(r)})):Z(t,(function(t){t.bbox=t.bbox?t.bbox:mt(t),e.push(t)})),gt.prototype.load.call(this,e)},e.remove=function(t){if(Array.isArray(t)){var e=t;(t=yt(e)).bbox=e}return gt.prototype.remove.call(this,t)},e.clear=function(){return gt.prototype.clear.call(this)},e.search=function(t){return{type:"FeatureCollection",features:gt.prototype.search.call(this,this.toBBox(t))}},e.collides=function(t){return gt.prototype.collides.call(this,this.toBBox(t))},e.all=function(){return{type:"FeatureCollection",features:gt.prototype.all.call(this)}},e.toJSON=function(){return gt.prototype.toJSON.call(this)},e.fromJSON=function(t){return gt.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;return{minX:(e=t.bbox?t.bbox:Array.isArray(t)&&4===t.length?t:mt(t))[0],minY:e[1],maxX:e[2],maxY:e[3]}},e};const bt=function(t){if(!t)throw new Error("geojson is required");var e=[];return K(t,(function(t){!function(t,e){var r=[],n=t.geometry;switch(n.type){case"Polygon":r=T(n);break;case"LineString":r=[T(n)]}r.forEach((function(r){(function(t,e){var r=[];return t.reduce((function(t,n){var i,o,a,s,l,c,u=F([t,n],e);return u.bbox=(o=n,a=(i=t)[0],s=i[1],l=o[0],c=o[1],[a<l?a:l,s<c?s:c,a>l?a:l,s>c?s:c]),r.push(u),n})),r})(r,t.properties).forEach((function(t){t.id=e.length,e.push(t)}))}))}(t,e)})),k(e)};function wt(t,e){var r=T(t),n=T(e);if(2!==r.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==n.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=r[0][0],o=r[0][1],a=r[1][0],s=r[1][1],l=n[0][0],c=n[0][1],u=n[1][0],p=n[1][1],f=(p-c)*(a-i)-(u-l)*(s-o),d=(u-l)*(o-c)-(p-c)*(i-l),h=(a-i)*(o-c)-(s-o)*(i-l);if(0===f)return null;var g=d/f,y=h/f;return g>=0&&g<=1&&y>=0&&y<=1?L([i+g*(a-i),o+g*(s-o)]):null}const xt=function(t,e){var r={},n=[];if("LineString"===t.type&&(t=C(t)),"LineString"===e.type&&(e=C(e)),"Feature"===t.type&&"Feature"===e.type&&"LineString"===t.geometry.type&&"LineString"===e.geometry.type&&2===t.geometry.coordinates.length&&2===e.geometry.coordinates.length){var i=wt(t,e);return i&&n.push(i),k(n)}var o=vt();return o.load(bt(e)),Z(bt(t),(function(t){Z(o.search(t),(function(e){var i=wt(t,e);if(i){var o=T(i).join(",");r[o]||(r[o]=!0,n.push(i))}}))})),k(n)};function Mt(t,e){return t.length>1?_(t,e):F(t[0],e)}const Pt=function(t,e){if(!D(e=e||{}))throw new Error("options is invalid");var r=e.properties,n=function(t,e){if(!t)throw new Error((e||"geojson")+" is required");if(t.geometry&&t.geometry.type)return t.geometry.type;if(t.type)return t.type;throw new Error((e||"geojson")+" is invalid")}(t),i=T(t);if(r=r||t.properties||{},!i.length)throw new Error("polygon must contain coordinates");switch(n){case"Polygon":return Mt(i,r);case"MultiPolygon":var o=[];return i.forEach((function(t){o.push(Mt(t,r))})),k(o);default:throw new Error("geom "+n+" not supported")}};function St(t,e){for(var r=0;r<t.coordinates.length-1;r++)if(jt(t.coordinates[r],t.coordinates[r+1],e.coordinates))return!0;return!1}function Ot(t,e){for(var r=0;r<e.coordinates.length;r++)if(J(e.coordinates[r],t))return!0;return xt(e,Pt(t)).features.length>0}function jt(t,e,r){var n=r[0]-t[0],i=r[1]-t[1],o=e[0]-t[0],a=e[1]-t[1];return 0==n*a-i*o&&(Math.abs(o)>=Math.abs(a)?o>0?t[0]<=r[0]&&r[0]<=e[0]:e[0]<=r[0]&&r[0]<=t[0]:a>0?t[1]<=r[1]&&r[1]<=e[1]:e[1]<=r[1]&&r[1]<=t[1])}const Et=function(t,e){var r;return K(t,(function(t){K(e,(function(e){if(!1===r)return!1;r=function(t,e){switch(t.type){case"Point":switch(e.type){case"Point":return r=t.coordinates,n=e.coordinates,!(r[0]===n[0]&&r[1]===n[1]);case"LineString":return!St(e,t);case"Polygon":return!J(t,e)}break;case"LineString":switch(e.type){case"Point":return!St(t,e);case"LineString":return!function(t,e){if(xt(t,e).features.length>0)return!0;return!1}(t,e);case"Polygon":return!Ot(e,t)}break;case"Polygon":switch(e.type){case"Point":return!J(e,t);case"LineString":return!Ot(t,e);case"Polygon":return!function(t,e){for(var r=0;r<t.coordinates[0].length;r++)if(J(t.coordinates[0][r],e))return!0;for(var n=0;n<e.coordinates[0].length;n++)if(J(e.coordinates[0][n],t))return!0;if(xt(Pt(t),Pt(e)).features.length>0)return!0;return!1}(e,t)}}var r,n}(t.geometry,e.geometry)}))})),r};const Ct=function(t,e,r){if(!D(r=r||{}))throw new Error("options is invalid");var n=r.units,i=q(t),o=q(e),a=Y(o[1]-i[1]),s=Y(o[0]-i[0]),l=Y(i[1]),c=Y(o[1]),u=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(l)*Math.cos(c);return I(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),n)};function Lt(t,e,r){if(!D(r=r||{}))throw new Error("options is invalid");if(!0===r.final)return function(t,e){var r=Lt(e,t);return r=(r+180)%360}(t,e);var n=q(t),i=q(e),o=Y(n[0]),a=Y(i[0]),s=Y(n[1]),l=Y(i[1]),c=Math.sin(a-o)*Math.cos(l),u=Math.cos(s)*Math.sin(l)-Math.sin(s)*Math.cos(l)*Math.cos(a-o);return B(Math.atan2(c,u))}const At=Lt;const Ft=function(t,e,r,n){if(!D(n=n||{}))throw new Error("options is invalid");var i=n.units,o=n.properties,a=q(t),s=Y(a[0]),l=Y(a[1]),c=Y(r),u=V(e,i),p=Math.asin(Math.sin(l)*Math.cos(u)+Math.cos(l)*Math.sin(u)*Math.cos(c));return L([B(s+Math.atan2(Math.sin(c)*Math.sin(u)*Math.cos(l),Math.cos(u)-Math.sin(l)*Math.sin(p))),B(p)],o)};const kt=function(t,e,r){if(!D(r=r||{}))throw new Error("options is invalid");var n=t.geometry?t.geometry.type:t.type;if("LineString"!==n&&"MultiLineString"!==n)throw new Error("lines must be LineString or MultiLineString");var i=L([1/0,1/0],{dist:1/0}),o=0;return K(t,(function(t){for(var n=T(t),a=0;a<n.length-1;a++){var s=L(n[a]);s.properties.dist=Ct(e,s,r);var l=L(n[a+1]);l.properties.dist=Ct(e,l,r);var c=Ct(s,l,r),u=Math.max(s.properties.dist,l.properties.dist),p=At(s,l),f=Ft(e,u,p+90,r),d=Ft(e,u,p-90,r),h=xt(F([f.geometry.coordinates,d.geometry.coordinates]),F([s.geometry.coordinates,l.geometry.coordinates])),g=null;h.features.length>0&&((g=h.features[0]).properties.dist=Ct(e,g,r),g.properties.location=o+Ct(s,g,r)),s.properties.dist<i.properties.dist&&((i=s).properties.index=a,i.properties.location=o),l.properties.dist<i.properties.dist&&((i=l).properties.index=a+1,i.properties.location=o+c),g&&g.properties.dist<i.properties.dist&&((i=g).properties.index=a),o+=c}})),i};const _t=function(t,e){var r=Ct(t,e),n=At(t,e);return Ft(t,r/2,n)};function It(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Vt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Vt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Bt="VERTICAL_GUIDE",Yt="HORIZONTAL_GUIDE",Xt=function(t,e,r,n){var i=t.getCanvas(),o=i.width,a=i.height,s=t.project(r),l=s.x,c=s.y;(l>0&&l<o&&c>0&&c<a||n)&&e.push(r)},Dt=function(t,e,r){var n,i,o,a,s,l=e.getAll().features,c=[],u=(n=t.getCanvas(),i=n.width,o=n.height,t.unproject([0,0]).toArray(),a=t.unproject([i,0]).toArray(),t.unproject([i,o]).toArray(),s=t.unproject([0,o]).toArray(),G([s,a].flat())),f=[],d=function e(r){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Array.isArray(r))throw Error("Your array is not an array");Array.isArray(r[0])?r.forEach((function(t){e(t)})):2===r.length&&Xt(t,f,r,n)};return l.forEach((function(t){t.id!==r.id?t.id!==Yt&&t.id!==Bt&&(d(t.geometry.coordinates),Et(u,t)||c.push(t)):r.type===p&&d(t.geometry.coordinates[0].slice(0,-2),!0)})),[c,f]},Ut=function(t,e){var r={};return e.forEach((function(e,n){var i=function(t,e){var r=[t.lng,t.lat],n="Point"===e.geometry.type,i="Polygon"===e.geometry.type,o=void 0,a=T(e);if(n){var s=It(a,2);return{latlng:{lng:s[0],lat:s[1]},distance:Ct(a,r)}}o=i?Pt(e):e;var l=kt(o,r),c=It(l.geometry.coordinates,2),u=c[0],p=c[1],f=l.properties.index;return f+1===o.geometry.coordinates.length&&f--,{latlng:{lng:u,lat:p},segment:o.geometry.coordinates.slice(f,f+2),distance:l.properties.dist,isMarker:n}}(t,e);(void 0===r.distance||i.distance<r.distance)&&((r=i).layer=e)})),r},$t=function(t,e){var r,n,i,o,a,s,l,c,u,p,f,d,h=e.lngLat.lng,g=e.lngLat.lat;if(e.originalEvent.altKey)return t.showVerticalSnapLine=!1,t.showHorizontalSnapLine=!1,{lng:h,lat:g};if(t.snapList.length<=0)return{lng:h,lat:g};if(t.options.snap){if(r=Ut({lng:h,lat:g},t.snapList),0===Object.keys(r).length)return!1;i=r.isMarker?r.latlng:function(t,e,r){var n=t.segment[0],i=t.segment[1],o=[t.latlng.lng,t.latlng.lat],a=Ct(n,o),s=Ct(i,o),l=a<s?n:i,c=a<s?a:s;if(e&&e.snapToMidPoints){var u=_t(n,i).geometry.coordinates,p=Ct(u,o);p<a&&p<s&&(l=u,c=p)}var f=It(c<(r||1.25)?l:o,2);return{lng:f[0],lat:f[1]}}(r,t.options.snapOptions,t.options.snapOptions.snapVertexPriorityDistance),n=(t.options.snapOptions&&t.options.snapOptions.snapPx||15)*(o=i.lat,a=t.map.getZoom(),s=o*(Math.PI/180),40075017*Math.cos(s)/Math.pow(2,a+8))}if(t.options.guides){var y=(u=t.vertices,p=e.lngLat,f=[],d=[],u.forEach((function(t){f.push(t[0]),d.push(t[1])})),{verticalPx:f.find((function(t){return Math.abs(t-p.lng)<.009})),horizontalPx:d.find((function(t){return Math.abs(t-p.lat)<.009}))});if(c=y.horizontalPx,l=y.verticalPx){var m={lng:l,lat:e.lngLat.lat+10},v={lng:l,lat:e.lngLat.lat-10};t.verticalGuide.updateCoordinate(0,m.lng,m.lat),t.verticalGuide.updateCoordinate(1,v.lng,v.lat)}if(c){var b={lng:e.lngLat.lng+10,lat:c},w={lng:e.lngLat.lng-10,lat:c};t.horizontalGuide.updateCoordinate(0,b.lng,b.lat),t.horizontalGuide.updateCoordinate(1,w.lng,w.lat)}t.showVerticalSnapLine=!!l,t.showHorizontalSnapLine=!!c}return r&&1e3*r.distance<n?i:l||c?(l&&(h=l),c&&(g=c),{lng:h,lat:g}):{lng:h,lat:g}},Gt=function(t){return{id:t,type:u,properties:{isSnapGuide:"true"},geometry:{type:f,coordinates:[]}}},qt=function(t,e){return!(e.properties.id!==Bt||t.options.guides&&t.showVerticalSnapLine)||!(e.properties.id!==Yt||t.options.guides&&t.showHorizontalSnapLine)};function Tt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Nt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Nt(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Nt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function zt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Jt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Rt=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?zt(Object(r),!0).forEach((function(e){Jt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):zt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},O);Rt.onSetup=function(t){var e=this,r=this.newFeature({type:u,properties:{},geometry:{type:d,coordinates:[[]]}}),n=this.newFeature(Gt(Bt)),i=this.newFeature(Gt(Yt));this.addFeature(r),this.addFeature(n),this.addFeature(i);var o=this.getSelected();this.clearSelectedFeatures(),w.disable(this);var a=Tt(Dt(this.map,this._ctx.api,r),2),s=a[0],l=a[1],c={map:this.map,point:r,vertices:l,snapList:s,selectedFeatures:o,verticalGuide:n,horizontalGuide:i};c.options=this._ctx.options;var p=function(){var t=Tt(Dt(e.map,e._ctx.api,r),2),n=t[0],i=t[1];c.vertices=i,c.snapList=n};c.moveendCallback=p;var f=function(t){c.options=t};return c.optionsChangedCallBAck=f,this.map.on("moveend",p),this.map.on("draw.snap.options_changed",f),c},Rt.onClick=function(t){O.onClick.call(this,t,{lngLat:{lng:t.snappedLng,lat:t.snappedLat}})},Rt.onMouseMove=function(t,e){var r=$t(t,e),i=r.lng,a=r.lat;t.snappedLng=i,t.snappedLat=a,t.lastVertex&&t.lastVertex[0]===i&&t.lastVertex[1]===a?this.updateUIClasses({mouse:o}):this.updateUIClasses({mouse:n})},Rt.toDisplayFeatures=function(t,e,r){qt(t,e)||O.toDisplayFeatures(t,e,r)},Rt.onStop=function(t){this.deleteFeature(Bt,{silent:!0}),this.deleteFeature(Yt,{silent:!0}),this.map.off("moveend",t.moveendCallback),O.onStop.call(this,t)};const Zt=Rt;const Ht=function(t,e){return!!t.lngLat&&(t.lngLat.lng===e[0]&&t.lngLat.lat===e[1])};function Kt(t,e,r,n){return{type:u,properties:{meta:m,parent:t,coord_path:r,active:n?v:b},geometry:{type:d,coordinates:e}}}const Qt={onSetup:function(t){const e=(t=t||{}).featureId;let r,i,o="forward";if(e){if(r=this.getFeature(e),!r)throw new Error("Could not find a feature with the provided featureId");let n=t.from;if(n&&"Feature"===n.type&&n.geometry&&"Point"===n.geometry.type&&(n=n.geometry),n&&"Point"===n.type&&n.coordinates&&2===n.coordinates.length&&(n=n.coordinates),!n||!Array.isArray(n))throw new Error("Please use the `from` property to indicate which point to continue the line from");const a=r.coordinates.length-1;if(r.coordinates[a][0]===n[0]&&r.coordinates[a][1]===n[1])i=a+1,r.addCoordinate(i,...r.coordinates[a]);else{if(r.coordinates[0][0]!==n[0]||r.coordinates[0][1]!==n[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");o="backwards",i=0,r.addCoordinate(i,...r.coordinates[0])}}else r=this.newFeature({type:u,properties:{},geometry:{type:f,coordinates:[]}}),i=0,this.addFeature(r);return this.clearSelectedFeatures(),w.disable(this),this.updateUIClasses({mouse:n}),this.activateUIButton(l),this.setActionableState({trash:!0}),{line:r,currentVertexPosition:i,direction:o}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&Ht(e,t.line.coordinates[t.currentVertexPosition-1])||"backwards"===t.direction&&Ht(e,t.line.coordinates[t.currentVertexPosition+1]))return this.changeMode(h,{featureIds:[t.line.id]});this.updateUIClasses({mouse:n}),t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),"forward"===t.direction?(t.currentVertexPosition++,t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)):t.line.addCoordinate(0,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(h,{featureIds:[t.line.id]})},onMouseMove:function(t,e){t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),x(e)&&this.updateUIClasses({mouse:o})}};Qt.onTap=Qt.onClick=function(t,e){if(x(e))return this.clickOnVertex(t,e);this.clickAnywhere(t,e)},Qt.onKeyUp=function(t,e){P(e)?this.changeMode(h,{featureIds:[t.line.id]}):M(e)&&(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(h))},Qt.onStop=function(t){w.enable(this),this.activateUIButton(),void 0!==this.getFeature(t.line.id)&&(t.line.removeCoordinate(`${t.currentVertexPosition}`),t.line.isValid()?this.map.fire(g,{features:[t.line.toGeoJSON()]}):(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(h,{},{silent:!0})))},Qt.onTrash=function(t){this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(h)},Qt.toDisplayFeatures=function(t,e,r){const n=e.properties.id===t.line.id;if(e.properties.active=n?v:b,!n)return r(e);e.geometry.coordinates.length<2||(e.properties.meta=y,r(Kt(t.line.id,e.geometry.coordinates["forward"===t.direction?e.geometry.coordinates.length-2:1],""+("forward"===t.direction?e.geometry.coordinates.length-2:1),!1)),r(e))};const Wt=Qt;function te(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return ee(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ee(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ee(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function re(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ne(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var ie=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?re(Object(r),!0).forEach((function(e){ne(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},Wt);ie.onSetup=function(t){var e=this,r=this.newFeature({type:u,properties:{},geometry:{type:f,coordinates:[[]]}}),n=this.newFeature(Gt(Bt)),i=this.newFeature(Gt(Yt));this.addFeature(r),this.addFeature(n),this.addFeature(i);var o=this.getSelected();this.clearSelectedFeatures(),w.disable(this);var a=te(Dt(this.map,this._ctx.api,r),2),s=a[0],l=a[1],c={map:this.map,line:r,currentVertexPosition:0,vertices:l,snapList:s,selectedFeatures:o,verticalGuide:n,horizontalGuide:i,direction:"forward"};c.options=this._ctx.options;var p=function(){var t=te(Dt(e.map,e._ctx.api,r),2),n=t[0],i=t[1];c.vertices=i,c.snapList=n};c.moveendCallback=p;var d=function(t){c.options=t};return c.optionsChangedCallBAck=d,this.map.on("moveend",p),this.map.on("draw.snap.options_changed",d),c},ie.onClick=function(t){var e=t.snappedLng,r=t.snappedLat;if(t.currentVertexPosition>0){var n=t.line.coordinates[t.currentVertexPosition-1];if(t.lastVertex=n,n[0]===e&&n[1]===r)return this.changeMode(h,{featureIds:[t.line.id]})}Xt(t.map,t.vertices,{lng:e,lat:r}),t.line.updateCoordinate(t.currentVertexPosition,e,r),t.currentVertexPosition++,t.line.updateCoordinate(t.currentVertexPosition,e,r)},ie.onMouseMove=function(t,e){var r=$t(t,e),i=r.lng,a=r.lat;t.line.updateCoordinate(t.currentVertexPosition,i,a),t.snappedLng=i,t.snappedLat=a,t.lastVertex&&t.lastVertex[0]===i&&t.lastVertex[1]===a?this.updateUIClasses({mouse:o}):this.updateUIClasses({mouse:n})},ie.toDisplayFeatures=function(t,e,r){qt(t,e)||Wt.toDisplayFeatures(t,e,r)},ie.onStop=function(t){this.deleteFeature(Bt,{silent:!0}),this.deleteFeature(Yt,{silent:!0}),this.map.off("moveend",t.moveendCallback),Wt.onStop.call(this,t)};const oe=ie,ae={onSetup:function(){const t=this.newFeature({type:u,properties:{},geometry:{type:p,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),w.disable(this),this.updateUIClasses({mouse:n}),this.activateUIButton(s),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&Ht(e,t.polygon.coordinates[0][t.currentVertexPosition-1]))return this.changeMode(h,{featureIds:[t.polygon.id]});this.updateUIClasses({mouse:n}),t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(h,{featureIds:[t.polygon.id]})},onMouseMove:function(t,e){t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat),x(e)&&this.updateUIClasses({mouse:o})}};ae.onTap=ae.onClick=function(t,e){return x(e)?this.clickOnVertex(t,e):this.clickAnywhere(t,e)},ae.onKeyUp=function(t,e){M(e)?(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(h)):P(e)&&this.changeMode(h,{featureIds:[t.polygon.id]})},ae.onStop=function(t){this.updateUIClasses({mouse:a}),w.enable(this),this.activateUIButton(),void 0!==this.getFeature(t.polygon.id)&&(t.polygon.removeCoordinate(`0.${t.currentVertexPosition}`),t.polygon.isValid()?this.map.fire(g,{features:[t.polygon.toGeoJSON()]}):(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(h,{},{silent:!0})))},ae.toDisplayFeatures=function(t,e,r){const n=e.properties.id===t.polygon.id;if(e.properties.active=n?v:b,!n)return r(e);if(0===e.geometry.coordinates.length)return;const i=e.geometry.coordinates[0].length;if(!(i<3)){if(e.properties.meta=y,r(Kt(t.polygon.id,e.geometry.coordinates[0][0],"0.0",!1)),i>3){const n=e.geometry.coordinates[0].length-3;r(Kt(t.polygon.id,e.geometry.coordinates[0][n],`0.${n}`,!1))}if(i<=4){const t=[[e.geometry.coordinates[0][0][0],e.geometry.coordinates[0][0][1]],[e.geometry.coordinates[0][1][0],e.geometry.coordinates[0][1][1]]];if(r({type:u,properties:e.properties,geometry:{coordinates:t,type:f}}),3===i)return}return r(e)}},ae.onTrash=function(t){this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(h)};const se=ae;function le(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return ce(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ce(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ce(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ue(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function pe(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var fe=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ue(Object(r),!0).forEach((function(e){pe(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ue(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},se);fe.onSetup=function(t){var e=this,r=this.newFeature({type:u,properties:{},geometry:{type:p,coordinates:[[]]}}),n=this.newFeature(Gt(Bt)),i=this.newFeature(Gt(Yt));this.addFeature(r),this.addFeature(n),this.addFeature(i);var o=this.getSelected();this.clearSelectedFeatures(),w.disable(this);var a=le(Dt(this.map,this._ctx.api,r),2),s=a[0],l=a[1],c={map:this.map,polygon:r,currentVertexPosition:0,vertices:l,snapList:s,selectedFeatures:o,verticalGuide:n,horizontalGuide:i};c.options=this._ctx.options;var f=function(){var t=le(Dt(e.map,e._ctx.api,r),2),n=t[0],i=t[1];c.vertices=i,c.snapList=n};c.moveendCallback=f;var d=function(t){c.options=t};return c.optionsChangedCallBAck=d,this.map.on("moveend",f),this.map.on("draw.snap.options_changed",d),c},fe.onClick=function(t){var e=t.snappedLng,r=t.snappedLat;if(t.currentVertexPosition>0){var n=t.polygon.coordinates[0][t.currentVertexPosition-1];if(t.lastVertex=n,n[0]===e&&n[1]===r)return this.changeMode(h,{featureIds:[t.polygon.id]})}Xt(t.map,t.vertices,{lng:e,lat:r}),t.polygon.updateCoordinate("0.".concat(t.currentVertexPosition),e,r),t.currentVertexPosition++,t.polygon.updateCoordinate("0.".concat(t.currentVertexPosition),e,r)},fe.onMouseMove=function(t,e){var r=$t(t,e),i=r.lng,a=r.lat;t.polygon.updateCoordinate("0.".concat(t.currentVertexPosition),i,a),t.snappedLng=i,t.snappedLat=a,t.lastVertex&&t.lastVertex[0]===i&&t.lastVertex[1]===a?this.updateUIClasses({mouse:o}):this.updateUIClasses({mouse:n})},fe.toDisplayFeatures=function(t,e,r){qt(t,e)||se.toDisplayFeatures(t,e,r)},fe.onStop=function(t){this.deleteFeature(Bt,{silent:!0}),this.deleteFeature(Yt,{silent:!0}),this.map.off("moveend",t.moveendCallback),this.map.off("draw.snap.options_changed",t.optionsChangedCallBAck),se.onStop.call(this,t)};const de=fe;function he(t){return function(t){if(Array.isArray(t))return ge(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return ge(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ge(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ge(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ye(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function me(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ye(Object(r),!0).forEach((function(e){ve(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ye(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ve(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var be=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}].map((function(t){return"gl-draw-line-inactive"===t.id?me(me({},t),{},{filter:[].concat(he(t.filter),[["!=","user_isSnapGuide","true"]])}):t}));const we=[].concat(he(be),[{id:"guide",type:"line",filter:["all",["==","$type","LineString"],["==","user_isSnapGuide","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#c00c00","line-width":1,"line-dasharray":[5,5]}}])}},e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}return r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r(491)})()}));
//# sourceMappingURL=mapbox-gl-draw-snap-mode.js.map